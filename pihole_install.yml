---
# Ten playbook instaluje Pi-hole w trybie bezobsługowym (unattended).
# Jest to idealne rozwiązanie do automatyzacji wdrożeń.

- name: Automatyczna instalacja Pi-hole w trybie bezobsługowym
  hosts: pihole_hosts
  become: yes
  vars:
    pihole_install_script_url: "https://install.pihole.net"
    pihole_install_path: "/tmp/pihole-install.sh"

  tasks:
    - name: Pobieranie skryptu instalacyjnego
      ansible.builtin.get_url:
        url: "{{ pihole_install_script_url }}"
        dest: "{{ pihole_install_path }}"
        mode: '0755'
      # To zadanie pobiera oficjalny skrypt instalacyjny z internetu.

    - name: Uruchomienie instalacji z flagą --unattended
      ansible.builtin.shell:
        cmd: "{{ pihole_install_path }} --unattended"
      args:
        creates: /etc/pihole/setupVars.conf
      # Flaga `--unattended` zapewnia, że instalacja przebiegnie bez
      # konieczności interakcji ze strony użytkownika.
      # `creates` zapobiega ponownemu uruchomieniu zadania po pierwszej instalacji.

    - name: Usunięcie tymczasowego skryptu
      ansible.builtin.file:
        path: "{{ pihole_install_path }}"
        state: absent
      # Sprzątanie po zakończonej instalacji.